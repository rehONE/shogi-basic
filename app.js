// =====================================
//  –§–£–ù–ö–¶–ò–Ø –î–õ–Ø –ü–õ–ê–í–ù–û–ô –°–ú–ï–ù–´ –ö–û–ù–¢–ï–ù–¢–ê
// =====================================
const content = document.getElementById("content");

function setContent(html) {
    content.classList.remove("fade");  // —Å–±—Ä–æ—Å –∞–Ω–∏–º–∞—Ü–∏–∏
    void content.offsetWidth;          // —Ç—Ä—é–∫ –¥–ª—è –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∞–Ω–∏–º–∞—Ü–∏–∏
    content.classList.add("fade");
    content.innerHTML = html;
}

// =====================================
//  –§–£–ù–ö–¶–ò–ò –î–õ–Ø –ö–ù–û–ü–û–ö –ú–ï–ù–Æ
// =====================================

// –§–∏–≥—É—Ä—ã
function showPieces() {
    let html = "<h2>–§–∏–≥—É—Ä—ã —Å—ë–≥–∏</h2>";
    shogiPieces.forEach(piece => {
        html += `
            <div class="piece">
                <h3>${piece.name} (${piece.kanji})</h3>
                <p><strong>–ß—Ç–µ–Ω–∏–µ:</strong> ${piece.reading}</p>
                <p><strong>–•–æ–¥:</strong> ${piece.move}</p>
                <img src="${piece.image}" alt="${piece.name}">
                <p><strong>–°—Ç–æ–∏–º–æ—Å—Ç—å:</strong> ${piece.value}</p>
            </div>
        `;
    });
    setContent(html);
}

// –ü—Ä–∞–≤–∏–ª–∞
function showRules() {
    setContent(`
        <div class="rules">
            <h2>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
            <ul>
                <li>–ò–≥—Ä–æ–∫–∏ —Ö–æ–¥—è—Ç –ø–æ –æ—á–µ—Ä–µ–¥–∏.</li>
                <li>–¶–µ–ª—å: –ø–æ—Å—Ç–∞–≤–∏—Ç—å –º–∞—Ç –∫–æ—Ä–æ–ª—é –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.</li>
                <li>–í–∑—è—Ç—ã–µ —Ñ–∏–≥—É—Ä—ã –º–æ–∂–Ω–æ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –Ω–∞ –¥–æ—Å–∫—É.</li>
                <li>–ü–µ—à–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –¥–≤–µ –≤ –æ–¥–Ω–æ–º —Å—Ç–æ–ª–±—Ü–µ.</li>
                <li>–ü–µ—à–∫–∞ –Ω–µ –º–æ–∂–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å—Ç–∞–≤–∏—Ç—å –º–∞—Ç –ø—Ä–∏ —Å–±—Ä–æ—Å–µ.</li>
                <li>–§–∏–≥—É—Ä—ã –º–æ–≥—É—Ç –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å—Å—è –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –∑–æ–Ω—ã –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞.</li>
                <li>–ü—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–µ –º–µ–Ω—è–µ—Ç —Ö–æ–¥ —Ñ–∏–≥—É—Ä—ã –Ω–∞ –±–æ–ª–µ–µ —Å–∏–ª—å–Ω—ã–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–µ—à–∫–∞ ‚Üí –∑–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª).</li>
                <li>–ù–µ –≤—Å–µ —Ñ–∏–≥—É—Ä—ã –º–æ–≥—É—Ç –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å—Å—è: –∫–æ—Ä–æ–ª—å –∏ –∑–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª –Ω–µ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç—Å—è.</li>
                <li>–ò–≥—Ä–æ–∫ –≤—ã–±–∏—Ä–∞–µ—Ç, –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å —Ñ–∏–≥—É—Ä—É –∏–ª–∏ –Ω–µ—Ç –ø—Ä–∏ –≤—Ö–æ–¥–µ –≤ –∑–æ–Ω—É –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è.</li>
            </ul>
            <p><strong>–¶–µ–Ω–Ω–æ—Å—Ç—å —Ñ–∏–≥—É—Ä:</strong> –ö–æ—Ä–æ–ª—å > –õ–∞–¥—å—è > –°–ª–æ–Ω > –ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª > –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –≥–µ–Ω–µ—Ä–∞–ª > –ö–æ–Ω—å > –ö–æ–ø—å—ë > –ü–µ—à–∫–∞.</p>
        </div>
    `);
}

// –°—Ç–æ–∏–º–æ—Å—Ç—å
function showCost() {
    let html = "<h2>–°—Ç–æ–∏–º–æ—Å—Ç—å —Ñ–∏–≥—É—Ä</h2><ul>";
    shogiPieces.forEach(piece => {
        html += `<li>${piece.name} (${piece.kanji}): ${piece.value}</li>`;
    });
    html += "</ul>";
    setContent(html);
}

// =====================================
//  –ú–ò–ù–ò-–¢–†–ï–ù–ê–ñ–Å–† "–£–ì–ê–î–ê–ô –§–ò–ì–£–†–£"
// =====================================
function showTrainer() {
    // –°–ø–∏—Å–æ–∫ —Ñ–∏–≥—É—Ä —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
    const pieces = [
        { name: "–ö–æ—Ä–æ–ª—å", image: "images/king_move.png" },
        { name: "–õ–∞–¥—å—è", image: "images/rook_move.png" },
        { name: "–°–ª–æ–Ω", image: "images/bishop_move.png" },
        { name: "–ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª", image: "images/gold_general_move.png" },
        { name: "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –≥–µ–Ω–µ—Ä–∞–ª", image: "images/silver_general_move.png" },
        { name: "–ö–æ–Ω—å", image: "images/knight_move.png" },
        { name: "–ö–æ–ø—å—ë", image: "images/lance_move.png" },
        { name: "–ü–µ—à–∫–∞", image: "images/pawn_move.png" }
    ];

    let correct;

    function nextRound() {
        // –°–ª—É—á–∞–π–Ω–∞—è —Ñ–∏–≥—É—Ä–∞
        correct = pieces[Math.floor(Math.random() * pieces.length)];

        // –°–æ–∑–¥–∞—ë–º 4 –≤–∞—Ä–∏–∞–Ω—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤
        let options = shuffleArray([...pieces]).slice(0, 4);

        // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º, —á—Ç–æ–±—ã –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ñ–∏–≥—É—Ä–∞ –±—ã–ª–∞ —Å—Ä–µ–¥–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
        if (!options.includes(correct)) options[0] = correct;
        options = shuffleArray(options);

        // HTML –∫–æ–Ω—Ç–µ–Ω—Ç
        let html = `
            <h2 style="text-align:center;">üß© –£–≥–∞–¥–∞–π —Ñ–∏–≥—É—Ä—É</h2>
            <img src="${correct.image}" class="test-image">
            <div style="text-align:center; margin-top:15px;">
        `;

        options.forEach(p => {
            html += `<button class="test-option">${p.name}</button>`;
        });
        html += `</div>`;

        setContent(html);

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏–π
        document.querySelectorAll(".test-option").forEach(btn => {
            btn.onclick = () => {
                if (btn.textContent === correct.name) {
                    btn.style.backgroundColor = "#4CAF50"; // –∑–µ–ª—ë–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
                } else {
                    btn.style.backgroundColor = "#f44336"; // –∫—Ä–∞—Å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
                }

                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç –∏ –±–ª–æ–∫–∏—Ä—É–µ–º –∫–Ω–æ–ø–∫–∏
                document.querySelectorAll(".test-option").forEach(b => {
                    b.disabled = true;
                    if (b.textContent === correct.name) b.style.backgroundColor = "#4CAF50";
                });

                // –ü–µ—Ä–µ—Ö–æ–¥ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ä–∞—É–Ω–¥—É —á–µ—Ä–µ–∑ 1.2 —Å–µ–∫—É–Ω–¥—ã
                setTimeout(nextRound, 1200);
            };
        });
    }

    nextRound();
}

// =====================================
//  –¢–ï–°–¢ –° –í–´–ë–û–†–û–ú –°–õ–û–ñ–ù–û–°–¢–ò
// =====================================
function showTestMenu() {
    setContent(`
        <h2 style="text-align:center;">üìù –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</h2>
        <div style="text-align:center;">
            <button onclick="startTest('easy')" class="test-option">–õ—ë–≥–∫–∏–π</button>
            <button onclick="startTest('medium')" class="test-option">–°—Ä–µ–¥–Ω–∏–π</button>
            <button onclick="startTest('hard')" class="test-option">–°–ª–æ–∂–Ω—ã–π</button>
        </div>
    `);
}

function startTest(level) {
const allQuestions = {
    easy: [
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ —Ö–æ–¥–∏—Ç –Ω–∞ 1 –∫–ª–µ—Ç–∫—É –≤–ø–µ—Ä—ë–¥?", options: ["–ü–µ—à–∫–∞", "–ö–æ–Ω—å", "–°–ª–æ–Ω"], a: "–ü–µ—à–∫–∞", img: "images/pawn_move.png" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ —Ö–æ–¥–∏—Ç –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –Ω–∞ –ª—é–±–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–µ—Ç–æ–∫?", options: ["–õ–∞–¥—å—è", "–°–ª–æ–Ω", "–ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª"], a: "–°–ª–æ–Ω", img: "images/bishop_move.png" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ —Å–∞–º–∞—è —Ü–µ–Ω–Ω–∞—è?", options: ["–ö–æ—Ä–æ–ª—å", "–ü–µ—à–∫–∞", "–ö–æ–Ω—å"], a: "–ö–æ—Ä–æ–ª—å", img: "images/king_move.png" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ —Ö–æ–¥–∏—Ç –±—É–∫–≤–æ–π –ì –≤–ø–µ—Ä—ë–¥?", options: ["–ö–æ–Ω—å", "–°–ª–æ–Ω", "–õ–∞–¥—å—è"], a: "–ö–æ–Ω—å", img: "images/knight_move.png" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ —Ç–æ–∫–∏–Ω?", options: ["–ü–µ—à–∫–∞", "–ö–æ–Ω—å", "–°–ª–æ–Ω"], a: "–ü–µ—à–∫–∞", img: "images/pawn_move.png" }
    ],
    medium: [
        { q: "–°–∫–æ–ª—å–∫–æ –ø–µ—à–µ–∫ –º–æ–∂–Ω–æ —Å—Ç–∞–≤–∏—Ç—å –≤ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü?", options: ["1", "2", "–ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–æ"], a: "1" },
        { q: "–ú–æ–∂–Ω–æ –ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å—Ç–∞–≤–∏—Ç—å –º–∞—Ç –ø–µ—à–∫–æ–π –ø—Ä–∏ —Å–±—Ä–æ—Å–µ?", options: ["–î–∞", "–ù–µ—Ç"], a: "–ù–µ—Ç" },
        { q: "–ö–∞–∫–∏–µ —Ñ–∏–≥—É—Ä—ã –Ω–µ –º–æ–≥—É—Ç –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å—Å—è?", options: ["–ö–æ—Ä–æ–ª—å –∏ –∑–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª", "–°–ª–æ–Ω –∏ –ª–∞–¥—å—è", "–ü–µ—à–∫–∞ –∏ –ö–æ–Ω—å"], a: "–ö–æ—Ä–æ–ª—å –∏ –∑–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ –∏–º–µ–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç—å 10 –æ—á–∫–æ–≤?", options: ["–õ–∞–¥—å—è", "–°–ª–æ–Ω", "–ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª"], a: "–õ–∞–¥—å—è" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ –º–æ–∂–µ—Ç –¥–≤–∏–≥–∞—Ç—å—Å—è –ø–æ –¥–∏–∞–≥–æ–Ω–∞–ª–∏ –∏ –≤–µ—Ä—Ç–∏–∫–∞–ª–∏ —Ç–æ–ª—å–∫–æ –≤–ø–µ—Ä—ë–¥?", options: ["–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –≥–µ–Ω–µ—Ä–∞–ª", "–ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª", "–ö–æ–Ω—å"], a: "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π –≥–µ–Ω–µ—Ä–∞–ª" },
        { q: "–ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ø—Ä–∏ –ø—Ä–µ–≤—Ä–∞—â–µ–Ω–∏–∏ –ø–µ—à–∫–∏ –≤ —Ç–æ–∫–∏–Ω?", options: ["–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å–∏–ª–∞ –∏ —Ö–æ–¥", "–°—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∫–æ—Ä–æ–ª—ë–º", "–°—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –ª–∞–¥—å—ë–π"], a: "–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å–∏–ª–∞ –∏ —Ö–æ–¥" },
        { q: "–ö–∞–∫–æ–π –ø–æ—Ä—è–¥–æ–∫ –∏–≥—Ä—ã?", options: ["–î–µ–±—é—Ç ‚Üí –ú–∏—Ç—Ç–µ–ª—å—à–ø–∏–ª—å ‚Üí –≠–Ω–¥—à–ø–∏–ª—å", "–≠–Ω–¥—à–ø–∏–ª—å ‚Üí –î–µ–±—é—Ç ‚Üí –ú–∏—Ç—Ç–µ–ª—å—à–ø–∏–ª—å", "–ú–∏—Ç—Ç–µ–ª—å—à–ø–∏–ª—å ‚Üí –î–µ–±—é—Ç ‚Üí –≠–Ω–¥—à–ø–∏–ª—å"], a: "–î–µ–±—é—Ç ‚Üí –ú–∏—Ç—Ç–µ–ª—å—à–ø–∏–ª—å ‚Üí –≠–Ω–¥—à–ø–∏–ª—å" },
        { q: "–ö–∞–∫–æ–π –≥–µ–Ω–µ—Ä–∞–ª –Ω–µ–ª—å–∑—è –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å?", options: ["–ó–æ–ª–æ—Ç–æ–π", "–°–µ—Ä–µ–±—Ä—è–Ω—ã–π", "–ö–æ–Ω—å"], a: "–ó–æ–ª–æ—Ç–æ–π" },
        { q: "–°–∫–æ–ª—å–∫–æ –∑–æ–Ω –ø—Ä–æ–¥–≤–∏–∂–µ–Ω–∏—è —É –∫–∞–∂–¥–æ–π —Å—Ç–æ—Ä–æ–Ω—ã?", options: ["3 —Ä—è–¥–∞", "4 —Ä—è–¥–∞", "2 —Ä—è–¥–∞"], a: "3 —Ä—è–¥–∞" },
        { q: "–ú–æ–∂–Ω–æ –ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –≤–∑—è—Ç—ã–µ —Ñ–∏–≥—É—Ä—ã –Ω–∞ –¥–æ—Å–∫—É?", options: ["–î–∞", "–ù–µ—Ç"], a: "–î–∞" }
    ],
    hard: [
        { q: "–°–∫–æ–ª—å–∫–æ –æ—á–∫–æ–≤ –≤–º–µ—Å—Ç–µ –¥–∞—é—Ç: –ü–µ—à–∫–∞ + –õ–∞–¥—å—è + –ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª?", options: ["17", "16", "15"], a: "17" },
        { q: "–ú–æ–∂–Ω–æ –ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –¥–≤–µ –ø–µ—à–∫–∏ –≤ –æ–¥–∏–Ω —Å—Ç–æ–ª–±–µ—Ü?", options: ["–î–∞", "–ù–µ—Ç"], a: "–ù–µ—Ç" },
        { q: "–ö–æ—Ä–æ–ª—å –º–æ–∂–µ—Ç –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å—Å—è?", options: ["–î–∞", "–ù–µ—Ç"], a: "–ù–µ—Ç" },
        { q: "–ï—Å–ª–∏ –ø–µ—à–∫–∞ –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç—Å—è, –≤–æ —á—Ç–æ –æ–Ω–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è?", options: ["–¢–æ–∫–∏–Ω", "–ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª", "–°–ª–æ–Ω"], a: "–¢–æ–∫–∏–Ω" },
        { q: "–°–∫–æ–ª—å–∫–æ –æ—á–∫–æ–≤ –≤–º–µ—Å—Ç–µ –¥–∞—é—Ç: –ö–æ–Ω—å + –°–µ—Ä–µ–±—Ä—è–Ω—ã–π –≥–µ–Ω–µ—Ä–∞–ª + –ü–µ—à–∫–∞?", options: ["10", "9", "8"], a: "10" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ –±–ª–æ–∫–∏—Ä—É–µ—Ç —Ü–µ–ª—ã–π —Ä—è–¥, –µ—Å–ª–∏ –ø–æ—Å—Ç–∞–≤–∏—Ç—å –µ—ë –≤ —ç–Ω–¥—à–ø–∏–ª–µ?", options: ["–õ–∞–¥—å—è", "–°–ª–æ–Ω", "–ó–æ–ª–æ—Ç–æ–π –≥–µ–Ω–µ—Ä–∞–ª"], a: "–õ–∞–¥—å—è" },
        { q: "–ú–æ–∂–Ω–æ –ª–∏ —Å—Ä–∞–∑—É –ø–æ—Å—Ç–∞–≤–∏—Ç—å –º–∞—Ç –ø–µ—à–∫–æ–π –ø–æ—Å–ª–µ —Å–±—Ä–æ—Å–∞?", options: ["–î–∞", "–ù–µ—Ç"], a: "–ù–µ—Ç" },
        { q: "–°–∫–æ–ª—å–∫–æ —Ñ–∞–∑ –≤ –∏–≥—Ä–µ –∏ –∫–∞–∫ –æ–Ω–∏ –Ω–∞–∑—ã–≤–∞—é—Ç—Å—è?", options: ["3: –î–µ–±—é—Ç ‚Üí –ú–∏—Ç—Ç–µ–ª—å—à–ø–∏–ª—å ‚Üí –≠–Ω–¥—à–ø–∏–ª—å", "2: –î–µ–±—é—Ç ‚Üí –≠–Ω–¥—à–ø–∏–ª—å", "4: –î–µ–±—é—Ç ‚Üí –ú–∏—Ç—Ç–µ–ª—å—à–ø–∏–ª—å ‚Üí –≠–Ω–¥—à–ø–∏–ª—å ‚Üí –§–∏–Ω–∞–ª"], a: "3: –î–µ–±—é—Ç ‚Üí –ú–∏—Ç—Ç–µ–ª—å—à–ø–∏–ª—å ‚Üí –≠–Ω–¥—à–ø–∏–ª—å" },
        { q: "–ö–∞–∫–∞—è —Ñ–∏–≥—É—Ä–∞ —Ö–æ–¥–∏—Ç –±—É–∫–≤–æ–π –ì –≤–ø–µ—Ä—ë–¥?", options: ["–ö–æ–Ω—å", "–°–ª–æ–Ω", "–õ–∞–¥—å—è"], a: "–ö–æ–Ω—å" },
        { q: "–ú–æ–∂–Ω–æ –ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤–∑—è—Ç—ã–µ —Ñ–∏–≥—É—Ä—ã –¥–ª—è –∞—Ç–∞–∫–∏?", options: ["–î–∞", "–ù–µ—Ç"], a: "–î–∞" }
    ]
};

    let countQuestions = { easy: 5, medium: 10, hard: 15 };
    let questions = shuffleArray([...allQuestions[level]]).slice(0, countQuestions[level]);
    let currentQuestion = 0;
    let score = 0;

    function nextQuestion() {
        if (currentQuestion >= questions.length) {
            setContent(`
                <h2>–¢–µ—Å—Ç –∑–∞–≤–µ—Ä—à—ë–Ω!</h2>
                <p style="text-align:center;">–í–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç: <strong>${score} –∏–∑ ${questions.length}</strong></p>
                <div style="text-align:center; margin-top:15px;">
                    <button onclick="showTestMenu()" class="test-option">–í—ã–±—Ä–∞—Ç—å —Å–ª–æ–∂–Ω–æ—Å—Ç—å —Å–Ω–æ–≤–∞</button>
                </div>
            `);
            return;
        }

        const q = questions[currentQuestion];
        let html = `<h2 style="text-align:center;">–í–æ–ø—Ä–æ—Å ${currentQuestion + 1}</h2>`;
        html += `<p style="text-align:center; font-size:18px;">${q.q}</p>`;
        if (level === "easy" && q.img) html += `<img src="${q.img}" class="test-image">`;

        html += `<div style="text-align:center; margin-top:10px;">`;
        shuffleArray(q.options).forEach(option => {
            html += `<button class="test-option">${option}</button>`;
        });
        html += `</div>`;

        setContent(html);

        document.querySelectorAll(".test-option").forEach(btn => {
            btn.onclick = () => {
                if (btn.textContent === q.a) score++;
                document.querySelectorAll(".test-option").forEach(b => {
                    b.disabled = true;
                    if (b.textContent === q.a) b.style.backgroundColor = "#4CAF50";
                    else if (btn.textContent === b.textContent) b.style.backgroundColor = "#f44336";
                });
                setTimeout(() => { currentQuestion++; nextQuestion(); }, 1200);
            };
        });
    }

    nextQuestion();
}


// =====================================
//  –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –§–£–ù–ö–¶–ò–ò
// =====================================
function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
}
